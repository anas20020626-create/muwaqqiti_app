<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</title>

<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<!-- Ø®Ø· Ø¹Ø«Ù…Ø§Ù† Ø·Ù‡ -->
<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">

<style>
:root{
  --dark-bg:#0b2a4a;
  --dark-text:#d4af37;
  --light-bg:#d4af37;
  --light-text:#0b2a4a;
}

body{
  margin:0;
  font-family:system-ui;
  background:var(--dark-bg);
  color:var(--dark-text);
  transition:.3s;
}

.light{
  background:var(--light-bg);
  color:var(--light-text);
}

header{
  text-align:center;
  padding:15px;
  font-size:22px;
  font-weight:bold;
}

section{
  display:none;
  padding:15px;
}

section.active{
  display:block;
}

.card{
  background:rgba(255,255,255,.08);
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
}

.prayer.next{
  border:2px solid currentColor;
  font-weight:bold;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:currentColor;
  color:inherit;
  font-size:16px;
}

nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:rgba(0,0,0,.2);
}

nav button{
  flex:1;
  border-radius:0;
}

.quran{
  font-family:'Amiri Quran', serif;
  font-size:20px;
  line-height:2;
}

select,input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
</style>
</head>

<body>

<header>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</header>

<section id="home" class="active">
  <div class="card" id="city">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>
  <div id="prayers"></div>
  <div class="card" id="countdown"></div>
</section>

<section id="qibla">
  <div class="card">ğŸ§­ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø© ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
</section>

<section id="quran">
  <select id="surahSelect"></select>
  <div class="card quran" id="ayahs"></div>
</section>

<section id="azkar">
  <div class="card">ğŸ“¿ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡<br>Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡<br>Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</div>
</section>

<section id="settings">
  <button onclick="toggleTheme()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</button>
  <input id="manualCity" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø¯ÙŠÙ†ØªÙƒ">
  <button onclick="saveCity()">Ø­ÙØ¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</button>
</section>

<nav>
  <button onclick="show('home')">ğŸ </button>
  <button onclick="show('qibla')">ğŸ§­</button>
  <button onclick="show('quran')">ğŸ“–</button>
  <button onclick="show('azkar')">ğŸ“¿</button>
  <button onclick="show('settings')">âš™ï¸</button>
</nav>

<script>
const sections=document.querySelectorAll('section');
function show(id){
  sections.forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function toggleTheme(){
  document.body.classList.toggle('light');
  localStorage.setItem('theme',document.body.classList.contains('light'));
}

if(localStorage.getItem('theme')==="true")document.body.classList.add('light');

function saveCity(){
  const c=document.getElementById('manualCity').value;
  if(c){
    localStorage.setItem('city',c);
    loadPrayer(c);
  }
}

function loadPrayer(city){
  document.getElementById('city').innerText=city;
  fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=SA`)
  .then(r=>r.json()).then(d=>{
    const t=d.data.timings;
    const prayers=[
      {n:'Ø§Ù„ÙØ¬Ø±',t:t.Fajr},
      {n:'Ø§Ù„Ø¸Ù‡Ø±',t:t.Dhuhr},
      {n:'Ø§Ù„Ø¹ØµØ±',t:t.Asr},
      {n:'Ø§Ù„Ù…ØºØ±Ø¨',t:t.Maghrib},
      {n:'Ø§Ù„Ø¹Ø´Ø§Ø¡',t:t.Isha},
    ];
    const now=new Date();
    let next;
    document.getElementById('prayers').innerHTML='';
    prayers.forEach(p=>{
      const [h,m]=p.t.split(':');
      const pt=new Date();
      pt.setHours(h,m,0);
      if(!next && pt>now)next=pt;
      document.getElementById('prayers').innerHTML+=
      `<div class="card prayer ${pt>now && !next?'next':''}">${p.n} : ${p.t}</div>`;
    });
    if(next){
      setInterval(()=>{
        const diff=next-new Date();
        const m=Math.floor(diff/60000);
        const s=Math.floor(diff/1000)%60;
        document.getElementById('countdown').innerText=
        `â³ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¨Ø¹Ø¯ ${m} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${s} Ø«Ø§Ù†ÙŠØ©`;
      },1000);
    }
  });
}

navigator.geolocation.getCurrentPosition(pos=>{
  fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=ar`)
  .then(r=>r.json()).then(d=>{
    const city=d.city||d.locality;
    localStorage.setItem('city',city);
    loadPrayer(city);
  });
},()=>{
  const c=localStorage.getItem('city')||'Ø§Ù„Ø±ÙŠØ§Ø¶';
  loadPrayer(c);
});

fetch('https://api.alquran.cloud/v1/surah')
.then(r=>r.json()).then(d=>{
  d.data.forEach(s=>{
    surahSelect.innerHTML+=`<option value="${s.number}">${s.name}</option>`;
  });
});

surahSelect.onchange=()=>{
  fetch(`https://api.alquran.cloud/v1/surah/${surahSelect.value}/quran-uthmani`)
  .then(r=>r.json()).then(d=>{
    ayahs.innerHTML=d.data.ayahs.map(a=>a.text).join(' ');
  });
};
</script>

</body>
</html>
