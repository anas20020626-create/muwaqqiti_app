<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</title>

<style>
:root{
  --bg-light:#f6e7b2;
  --text-light:#0a1f44;
  --card-light:#fff4cc;

  --bg-dark:#0a1f44;
  --text-dark:#f6e7b2;
  --card-dark:#132f5b;

  --gold:#d4af37;
}

body{
  margin:0;
  font-family:"Tajawal",sans-serif;
  background:var(--bg-light);
  color:var(--text-light);
}

body.dark{
  background:var(--bg-dark);
  color:var(--text-dark);
}

header{
  text-align:center;
  padding:15px;
  font-size:22px;
  font-weight:bold;
}

.card{
  background:var(--card-light);
  margin:10px;
  padding:15px;
  border-radius:14px;
}

body.dark .card{background:var(--card-dark);}

button{
  background:var(--gold);
  color:#0a1f44;
  border:none;
  padding:10px;
  border-radius:10px;
  font-weight:bold;
  margin:5px 0;
}

nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:var(--card-light);
}
body.dark nav{background:var(--card-dark);}
nav button{flex:1;border-radius:0;}

#compass{
  width:200px;
  height:200px;
  border:6px solid var(--gold);
  border-radius:50%;
  margin:20px auto;
  position:relative;
}

#needle{
  width:4px;
  height:90px;
  background:red;
  position:absolute;
  top:10px;
  left:50%;
  transform-origin:bottom;
}

#kaaba{
  position:absolute;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:24px;
}
</style>
</head>

<body>

<header>ðŸ§­ Ø§Ù„Ù‚Ø¨Ù„Ø©</header>

<div class="card" id="qibla">
  <div id="compass">
    <div id="needle"></div>
    <div id="kaaba">ðŸ•‹</div>
  </div>
  <p id="qiblaText" style="text-align:center">Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø¨Ù„Ø©</p>
</div>

<nav>
  <button onclick="toggleDark()">ðŸŒ™</button>
</nav>

<script>
let dark=false;
function toggleDark(){
  dark=!dark;
  document.body.classList.toggle("dark");
}

// Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ÙƒØ¹Ø¨Ø©
const KAABA_LAT = 21.4225;
const KAABA_LON = 39.8262;

// Ø­Ø³Ø§Ø¨ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©
function getQiblaDirection(lat, lon){
  const dLon = (KAABA_LON - lon) * Math.PI/180;
  const lat1 = lat * Math.PI/180;
  const lat2 = KAABA_LAT * Math.PI/180;

  const y = Math.sin(dLon);
  const x = Math.cos(lat1)*Math.tan(lat2) - Math.sin(lat1)*Math.cos(dLon);
  let brng = Math.atan2(y, x) * 180/Math.PI;
  return (brng + 360) % 360;
}

navigator.geolocation.getCurrentPosition(pos=>{
  const qiblaDir = getQiblaDirection(pos.coords.latitude, pos.coords.longitude);

  window.addEventListener("deviceorientation", e=>{
    const heading = e.alpha;
    if(!heading) return;

    const diff = qiblaDir - heading;
    document.getElementById("needle").style.transform =
      `rotate(${diff}deg)`;

    if(Math.abs(diff) < 5){
      document.getElementById("qiblaText").innerText = "âœ… Ø£Ù†Øª Ù…ØªØ¬Ù‡ Ù†Ø­Ùˆ Ø§Ù„Ù‚Ø¨Ù„Ø©";
      if(navigator.vibrate) navigator.vibrate(200);
    }else{
      document.getElementById("qiblaText").innerText = "Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù†Ø­Ùˆ Ø§Ù„Ù‚Ø¨Ù„Ø©";
    }
  });
});
</script>

</body>
</html>
