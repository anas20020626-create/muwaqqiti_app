<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Tahoma,Arial;
  background:#f6e7b2;
  color:#1f2d3d;
}
header{
  background:#1f2d3d;
  color:gold;
  text-align:center;
  padding:18px;
  font-size:28px;
  font-weight:bold;
}
.container{padding:15px}
button{
  padding:10px 18px;
  border:none;
  border-radius:12px;
  background:#1f2d3d;
  color:white;
  font-size:16px;
  cursor:pointer;
}
.card{
  background:white;
  border-radius:14px;
  padding:15px;
  margin-top:15px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}
.prayer{
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-radius:10px;
  margin:6px 0;
}
.next{
  background:gold;
  font-weight:bold;
}
#countdown{
  text-align:center;
  font-size:18px;
  margin-top:10px;
  color:#1f2d3d;
}

/* Modal */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:#fff3c4;
  padding:20px;
  border-radius:16px;
  width:90%;
  max-width:350px;
  text-align:center;
}
select,input{
  padding:8px;
  border-radius:8px;
  font-size:15px;
}
</style>
</head>

<body>

<header>âœ¨ Ù…ÙˆØ§Ù‚ÙŠØªÙŠ âœ¨</header>

<div class="container">

<select id="citySelect" onchange="render()">
  <option value="Makkah">Ù…ÙƒØ©</option>
  <option value="Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
  <option value="Jeddah">Ø¬Ø¯Ø©</option>
  <option value="Dammam">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
  <option value="Abha">Ø£Ø¨Ù‡Ø§</option>
</select>

<br><br>
<button onclick="openModal()">ğŸ“… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®</button>

<div class="card" id="hijriDate"></div>
<div class="card" id="prayers"></div>
<div id="countdown"></div>

</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®</h3>
    <input type="date" id="dateInput">
    <br><br>
    <button onclick="applyDate()">ØªÙ…</button>
    <button onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>

<script>
let selectedDate = new Date();
let countdownInterval;

function openModal(){ document.getElementById("modal").style.display="flex"; }
function closeModal(){ document.getElementById("modal").style.display="none"; }

function applyDate(){
  const v = document.getElementById("dateInput").value;
  if(v){ selectedDate = new Date(v); render(); }
  closeModal();
}

function hijriText(date){
  return new Intl.DateTimeFormat('ar-SA-u-ca-islamic',{
    weekday:'long', day:'numeric', month:'long', year:'numeric'
  }).format(date);
}

async function render(){
  clearInterval(countdownInterval);

  document.getElementById("hijriDate").innerText =
    "ğŸ“† " + hijriText(selectedDate);

  const city = citySelect.value;
  const d = selectedDate.getDate();
  const m = selectedDate.getMonth()+1;
  const y = selectedDate.getFullYear();

  const res = await fetch(
    `https://api.aladhan.com/v1/calendarByCity?city=${city}&country=Saudi Arabia&method=4&month=${m}&year=${y}`
  );
  const data = await res.json();
  const t = data.data[d-1].timings;

  const prayers = [
    {n:"Ø§Ù„ÙØ¬Ø±", t:t.Fajr},
    {n:"Ø§Ù„Ø¸Ù‡Ø±", t:t.Dhuhr},
    {n:"Ø§Ù„Ø¹ØµØ±", t:t.Asr},
    {n:"Ø§Ù„Ù…ØºØ±Ø¨", t:t.Maghrib},
    {n:"Ø§Ù„Ø¹Ø´Ø§Ø¡", t:t.Isha}
  ];

  const list = document.getElementById("prayers");
  list.innerHTML = "<h3>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h3>";

  const now = new Date();
  let nextTime=null, nextName="";

  prayers.forEach(p=>{
    const div=document.createElement("div");
    div.className="prayer";
    const [h,m]=p.t.split(":");
    const pt=new Date(selectedDate);
    pt.setHours(h,m,0);

    if(!nextTime && pt>now && selectedDate.toDateString()===now.toDateString()){
      div.classList.add("next");
      nextTime=pt; nextName=p.n;
    }
    div.innerHTML=`<span>${p.n}</span><span>${p.t}</span>`;
    list.appendChild(div);
  });

  if(nextTime){
    countdownInterval=setInterval(()=>{
      const diff=nextTime-new Date();
      if(diff<=0){ clearInterval(countdownInterval); render(); return; }
      const h=Math.floor(diff/3600000);
      const m=Math.floor((diff%3600000)/60000);
      const s=Math.floor((diff%60000)/1000);
      countdown.innerText=`Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (${nextName}) Ø¨Ø¹Ø¯ ${h}:${m}:${s}`;
    },1000);
  }else{
    countdown.innerText="Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ„Ø§Ø© Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„ÙŠÙˆÙ…";
  }
}

render();
</script>

</body>
</html>
