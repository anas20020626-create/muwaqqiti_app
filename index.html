<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #0b2a4a;
  color: gold;
}

/* Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
header {
  text-align: center;
  padding: 18px;
  font-size: 26px;
  font-weight: bold;
  letter-spacing: 2px;
  border-bottom: 1px solid gold;
}
header span {
  font-size: 30px;
}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.card {
  background: rgba(255,215,0,0.08);
  padding: 15px;
  margin: 15px;
  border-radius: 14px;
}

/* Ø§Ù„ØµÙ„ÙˆØ§Øª */
.prayer {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
}

/* Ù…Ù†Ø¨Ø«Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® */
.popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
}

.popup-content {
  background: #0b2a4a;
  border: 2px solid gold;
  border-radius: 14px;
  padding: 20px;
  text-align: center;
  width: 80%;
}

.popup-content h3 {
  margin-top: 0;
}

button {
  background: gold;
  color: #0b2a4a;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  margin: 5px;
  font-weight: bold;
}
</style>
</head>

<body>

<header>
  âœ¨ <span>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</span> âœ¨
</header>

<div class="card">
  <button onclick="showDate()">ğŸ“… Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ®</button>

  <div id="prayers"></div>
  <p id="countdown"></p>

  <button onclick="loadPrayers(0)">Ø§Ù„ÙŠÙˆÙ…</button>
  <button onclick="loadPrayers(1)">ØºØ¯Ù‹Ø§</button>
</div>

<!-- Ù…Ù†Ø¨Ø«Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® -->
<div class="popup" id="datePopup">
  <div class="popup-content">
    <h3 id="fullDate"></h3>
    <button onclick="loadPrayers(0)">Ø§Ù„ÙŠÙˆÙ…</button>
    <button onclick="loadPrayers(1)">ØºØ¯Ù‹Ø§</button>
    <br><br>
    <button onclick="closePopup()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
let currentDateText = "";

function showDate() {
  document.getElementById("fullDate").innerText = currentDateText;
  document.getElementById("datePopup").style.display = "flex";
}

function closePopup() {
  document.getElementById("datePopup").style.display = "none";
}

function loadPrayers(day) {
  navigator.geolocation.getCurrentPosition(pos => {
    fetch(`https://api.aladhan.com/v1/timings/${day}?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&method=4`)
      .then(r => r.json())
      .then(d => {
        const t = d.data.timings;

        // Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙƒØ§Ù…Ù„
        const hijri = d.data.date.hijri;
        const gregorianDay = d.data.date.gregorian.weekday.ar;
        currentDateText =
          `Ø§Ù„ÙŠÙˆÙ… ${gregorianDay} ${hijri.day} / ${hijri.month.number} / ${hijri.year} Ù‡Ù€`;

        const prayers = [
          ["Ø§Ù„ÙØ¬Ø±", t.Fajr],
          ["Ø§Ù„Ø¸Ù‡Ø±", t.Dhuhr],
          ["Ø§Ù„Ø¹ØµØ±", t.Asr],
          ["Ø§Ù„Ù…ØºØ±Ø¨", t.Maghrib],
          ["Ø§Ù„Ø¹Ø´Ø§Ø¡", t.Isha]
        ];

        let html = "";
        prayers.forEach(p => {
          html += `<div class="prayer"><span>${p[0]}</span><span>${p[1]}</span></div>`;
        });

        document.getElementById("prayers").innerHTML = html;
        startCountdown(prayers);
      });
  });
}

function startCountdown(prayers) {
  clearInterval(window.timer);
  window.timer = setInterval(() => {
    const now = new Date();
    for (let p of prayers) {
      const [h, m] = p[1].split(":");
      const time = new Date();
      time.setHours(h, m, 0, 0);
      if (time > now) {
        const diff = time - now;
        const min = Math.floor(diff / 60000);
        const sec = Math.floor((diff % 60000) / 1000);
        document.getElementById("countdown").innerText =
          `â³ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${p[0]} Ø¨Ø¹Ø¯ ${min} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${sec} Ø«Ø§Ù†ÙŠØ©`;
        return;
      }
    }
  }, 1000);
}

loadPrayers(0);
</script>

</body>
</html>
