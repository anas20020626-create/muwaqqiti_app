<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¨ÙˆØµÙ„Ø© Ø§Ù„Ù‚Ø¨Ù„Ø©</title>

<style>
body {
  background: #0b2a4a;
  color: gold;
  font-family: system-ui, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}

h2 {
  margin-top: 20px;
}

.compass-container {
  margin-top: 30px;
}

.compass {
  width: 260px;
  height: 260px;
  border-radius: 50%;
  border: 8px solid gold;
  margin: auto;
  position: relative;
  background: radial-gradient(circle, #123c66 60%, #0b2a4a);
}

.needle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: bottom center;
  transform: translate(-50%, -100%) rotate(0deg);
  font-size: 40px;
  color: red;
  transition: transform 0.15s linear;
}

.kaaba {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 22px;
}

.status {
  margin-top: 15px;
  font-size: 18px;
}
button {
  margin-top: 20px;
  padding: 10px 20px;
  background: gold;
  border: none;
  border-radius: 8px;
  font-size: 16px;
}
</style>
</head>

<body>

<h2>ğŸ§­ Ø¨ÙˆØµÙ„Ø© Ø§Ù„Ù‚Ø¨Ù„Ø©</h2>

<button onclick="startCompass()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØµÙ„Ø©</button>

<div class="compass-container">
  <div class="compass">
    <div class="kaaba">ğŸ•‹</div>
    <div class="needle" id="needle">â–²</div>
  </div>
</div>

<p class="status" id="status">Ø§Ø¶ØºØ· ØªØ´ØºÙŠÙ„ ÙˆÙˆØ¬Ù‘Ù‡ Ø§Ù„Ù‡Ø§ØªÙ</p>

<script>
const KAABA_LAT = 21.4225;
const KAABA_LNG = 39.8262;
let qiblaDirection = null;
let vibrated = false;

// Ø­Ø³Ø§Ø¨ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©
function getQiblaDirection(lat, lng) {
  const Ï†1 = lat * Math.PI / 180;
  const Ï†2 = KAABA_LAT * Math.PI / 180;
  const Î”Î» = (KAABA_LNG - lng) * Math.PI / 180;

  const y = Math.sin(Î”Î»);
  const x = Math.cos(Ï†1) * Math.tan(Ï†2) - Math.sin(Ï†1) * Math.cos(Î”Î»);
  let Î¸ = Math.atan2(y, x) * 180 / Math.PI;
  return (Î¸ + 360) % 360;
}

function startCompass() {
  if (typeof DeviceOrientationEvent !== "undefined" &&
      typeof DeviceOrientationEvent.requestPermission === "function") {
    DeviceOrientationEvent.requestPermission().then(response => {
      if (response === "granted") initCompass();
    });
  } else {
    initCompass();
  }
}

function initCompass() {
  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    qiblaDirection = getQiblaDirection(lat, lng);

    window.addEventListener("deviceorientationabsolute", handleOrientation, true);
    window.addEventListener("deviceorientation", handleOrientation, true);
  }, () => {
    document.getElementById("status").innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹";
  });
}

function handleOrientation(e) {
  if (!e.alpha || qiblaDirection === null) return;

  const heading = 360 - e.alpha;
  const diff = (qiblaDirection - heading + 360) % 360;

  document.getElementById("needle").style.transform =
    `translate(-50%, -100%) rotate(${diff}deg)`;

  const angle = Math.abs(diff > 180 ? diff - 360 : diff);

  if (angle < 5) {
    document.getElementById("status").innerText = "âœ… Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©";
    if (!vibrated) {
      navigator.vibrate(300);
      vibrated = true;
    }
  } else {
    document.getElementById("status").innerText =
      "ğŸ“ Ø§Ù†Ø­Ø±Ø§Ù: " + angle.toFixed(1) + "Â°";
    vibrated = false;
  }
}
</script>

</body>
</html>
