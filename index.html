<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</title>

<style>
:root{
  --bg-light:#f6e7b2;
  --text-light:#0a1f44;
  --card-light:#fff4cc;

  --bg-dark:#0a1f44;
  --text-dark:#f6e7b2;
  --card-dark:#132f5b;

  --gold:#d4af37;
}

body{
  margin:0;
  font-family:"Tajawal",sans-serif;
  background:var(--bg-light);
  color:var(--text-light);
  transition:.3s;
}

body.dark{
  background:var(--bg-dark);
  color:var(--text-dark);
}

header{
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

.card{
  background:var(--card-light);
  margin:10px;
  padding:15px;
  border-radius:14px;
}

body.dark .card{
  background:var(--card-dark);
}

button{
  background:var(--gold);
  color:#0a1f44;
  border:none;
  padding:10px 14px;
  border-radius:10px;
  font-weight:bold;
}

input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin:8px 0;
}

.prayer{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
}

.next{
  border:2px solid var(--gold);
  border-radius:10px;
  padding:10px;
  font-weight:bold;
}

nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:var(--card-light);
}

body.dark nav{background:var(--card-dark);}

nav button{
  flex:1;
  border-radius:0;
}
</style>
</head>

<body>

<header id="cityName">Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹â€¦</header>

<div class="card">
  <div id="countdown">â³</div>
</div>

<div class="card" id="prayers"></div>

<div class="card" id="settings" style="display:none">
  <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
  <input id="citySearch" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
  <div id="results"></div>
  <button onclick="toggleDark()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</button>
</div>

<nav>
  <button onclick="show('prayers')">ğŸ•Œ</button>
  <button onclick="show('settings')">âš™ï¸</button>
</nav>

<script>
let prayersData={},cities=[];
let dark=false;

fetch("cities-sa.json").then(r=>r.json()).then(d=>cities=d);

function toggleDark(){
  dark=!dark;
  document.body.classList.toggle("dark");
}

function show(id){
  document.getElementById("prayers").style.display="none";
  document.getElementById("settings").style.display="none";
  document.getElementById(id).style.display="block";
}

function load(city){
  document.getElementById("cityName").innerText=city;
  fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=SA&method=4`)
  .then(r=>r.json()).then(d=>{
    prayersData=d.data.timings;
    render();
  });
}

function render(){
  const order=["Fajr","Dhuhr","Asr","Maghrib","Isha"];
  const names={Fajr:"Ø§Ù„ÙØ¬Ø±",Dhuhr:"Ø§Ù„Ø¸Ù‡Ø±",Asr:"Ø§Ù„Ø¹ØµØ±",Maghrib:"Ø§Ù„Ù…ØºØ±Ø¨",Isha:"Ø§Ù„Ø¹Ø´Ø§Ø¡"};
  let now=new Date(),next=null;

  for(let p of order){
    let [h,m]=prayersData[p].split(":");
    let t=new Date(); t.setHours(h,m,0);
    if(t>now){next=p;break;}
  }
  if(!next) next="Fajr";

  let html="";
  order.forEach(p=>{
    html+=`<div class="prayer ${p===next?"next":""}">
      <span>${names[p]}</span>
      <span>${prayersData[p]}</span>
    </div>`;
  });
  document.getElementById("prayers").innerHTML=html;
  countdown(prayersData[next]);
}

function countdown(time){
  setInterval(()=>{
    let [h,m]=time.split(":");
    let target=new Date(); target.setHours(h,m,0);
    let diff=target-new Date();
    if(diff<0) diff+=86400000;
    let hrs=Math.floor(diff/3600000);
    let min=Math.floor(diff%3600000/60000);
    let sec=Math.floor(diff%60000/1000);
    document.getElementById("countdown").innerText=
      `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¨Ø¹Ø¯ ${hrs}:${min}:${sec}`;
  },1000);
}

navigator.geolocation.getCurrentPosition(pos=>{
  fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=ar`)
  .then(r=>r.json()).then(d=>{
    const city=d.city||d.locality;
    localStorage.setItem("city",city);
    load(city);
  });
},()=>{
  const c=localStorage.getItem("city")||"Ø§Ù„Ø±ÙŠØ§Ø¶";
  load(c);
});

document.getElementById("citySearch").oninput=e=>{
  let q=e.target.value;
  let res=document.getElementById("results");
  res.innerHTML="";
  cities.filter(c=>c.includes(q)).forEach(c=>{
    let d=document.createElement("div");
    d.className="card";
    d.innerText=c;
    d.onclick=()=>{
      localStorage.setItem("city",c);
      load(c);
    };
    res.appendChild(d);
  });
};
</script>

</body>
</html>
