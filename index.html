<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</title>

<style>
:root{
  --dark-bg:#0b2a4a;
  --dark-text:#d4af37;
  --light-bg:#d4af37;
  --light-text:#0b2a4a;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--dark-bg);
  color:var(--dark-text);
  transition:.3s;
}

.light{
  background:var(--light-bg);
  color:var(--light-text);
}

header{
  text-align:center;
  padding:15px;
  font-size:22px;
  font-weight:bold;
}

section{
  display:none;
  padding:15px;
}

section.active{
  display:block;
}

.card{
  background:rgba(255,255,255,.08);
  padding:15px;
  border-radius:15px;
  margin-bottom:12px;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:currentColor;
  color:inherit;
  font-size:16px;
  margin-top:10px;
}

input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}

nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:rgba(0,0,0,.25);
}

nav button{
  flex:1;
  border-radius:0;
}
</style>
</head>

<body>

<header>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØªÙŠ</header>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<section id="home" class="active">
  <div class="card" id="city">ğŸ“ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>
  <div id="prayers"></div>
  <div class="card" id="countdown"></div>
</section>

<!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<section id="settings">
  <div class="card">
    <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
    <button onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹</button>
  </div>

  <div class="card">
    <h3>ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§</h3>
    <input id="citySearch" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
    <div id="cityResults"></div>
    <button onclick="useLocation()">ğŸ“¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
  </div>
</section>

<nav>
  <button onclick="show('home')">ğŸ </button>
  <button onclick="show('settings')">âš™ï¸</button>
</nav>

<script>
/* ---------- ØªÙ†Ù‚Ù‘Ù„ ---------- */
function show(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ---------- Ø§Ù„ÙˆØ¶Ø¹ ---------- */
function toggleTheme(){
  document.body.classList.toggle("light");
  localStorage.setItem("theme",document.body.classList.contains("light"));
}
if(localStorage.getItem("theme")==="true"){
  document.body.classList.add("light");
}

/* ---------- Ø§Ù„Ù…Ø¯Ù† ---------- */
let cities=[];
fetch("cities-sa.json")
.then(r=>r.json())
.then(d=>cities=d);

const search=document.getElementById("citySearch");
const results=document.getElementById("cityResults");

search.oninput=()=>{
  const q=search.value.trim();
  results.innerHTML="";
  if(q.length<1) return;
  cities.filter(c=>c.includes(q)).forEach(c=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerText=c;
    div.onclick=()=>{
      localStorage.setItem("city",c);
      loadPrayer(c);
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
    };
    results.appendChild(div);
  });
};

/* ---------- Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª ---------- */
function loadPrayer(city){
  document.getElementById("city").innerText="ğŸ“ "+city;
  fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=SA&method=4`)
  .then(r=>r.json())
  .then(d=>{
    const t=d.data.timings;
    const prayers=[
      {n:"Ø§Ù„ÙØ¬Ø±",t:t.Fajr},
      {n:"Ø§Ù„Ø¸Ù‡Ø±",t:t.Dhuhr},
      {n:"Ø§Ù„Ø¹ØµØ±",t:t.Asr},
      {n:"Ø§Ù„Ù…ØºØ±Ø¨",t:t.Maghrib},
      {n:"Ø§Ù„Ø¹Ø´Ø§Ø¡",t:t.Isha}
    ];

    const now=new Date();
    let next=null;
    document.getElementById("prayers").innerHTML="";

    prayers.forEach(p=>{
      const [h,m]=p.t.split(":");
      const pt=new Date();
      pt.setHours(h,m,0);
      if(!next && pt>now) next={name:p.n,time:pt};
      document.getElementById("prayers").innerHTML+=
        `<div class="card">${p.n} : ${p.t}</div>`;
    });

    if(next){
      setInterval(()=>{
        const diff=next.time-new Date();
        if(diff<=0) return;
        const m=Math.floor(diff/60000);
        const s=Math.floor(diff/1000)%60;
        document.getElementById("countdown").innerText=
          `â³ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (${next.name}) Ø¨Ø¹Ø¯ ${m} Ø¯ ${s} Ø«`;
      },1000);
    }
  });
}

/* ---------- Ø§Ù„Ù…ÙˆÙ‚Ø¹ ---------- */
function useLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=ar`)
    .then(r=>r.json())
    .then(d=>{
      const city=d.city||d.locality;
      localStorage.setItem("city",city);
      loadPrayer(city);
    });
  },()=>{
    alert("ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§");
  });
}

/* ---------- Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ---------- */
const savedCity=localStorage.getItem("city");
if(savedCity){
  loadPrayer(savedCity);
}else{
  useLocation();
}
</script>

</body>
</html>
